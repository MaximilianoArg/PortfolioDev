<div class="dashboard-container">
  <div class="header">
    <h1>Dashboard Financiero</h1>
    <div class="header-actions">
      <button class="btn-primary" routerLink="/finanzas/cuentas">
        <i class="fas fa-university"></i> Gestionar Cuentas
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="cargando">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Cargando dashboard...</p>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="error && !cargando">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ error }}</p>
    <button class="btn-retry" (click)="cargarDashboard()">Reintentar</button>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-content" *ngIf="resumen && !cargando">
    <!-- Resumen General -->
    <div class="resumen-general">
      <div class="stat-card total">
        <div class="stat-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <div class="stat-info">
          <h3>Balance Total</h3>
          <p class="stat-value" [class]="obtenerColorBalance(resumen.totalGeneral)">
            {{ formatearMoneda(resumen.totalGeneral) }}
          </p>
          <small>{{ resumen.periodo }}</small>
        </div>
      </div>

      <div class="stat-card ingresos">
        <div class="stat-icon">
          <i class="fas fa-arrow-up"></i>
        </div>
        <div class="stat-info">
          <h3>Ingresos</h3>
          <p class="stat-value positivo">
            {{ formatearMoneda(resumen.ingresosGeneral) }}
          </p>
          <small>Total del período</small>
        </div>
      </div>

      <div class="stat-card gastos">
        <div class="stat-icon">
          <i class="fas fa-arrow-down"></i>
        </div>
        <div class="stat-info">
          <h3>Gastos</h3>
          <p class="stat-value negativo">
            {{ formatearMoneda(resumen.gastosGeneral) }}
          </p>
          <small>Total del período</small>
        </div>
      </div>

      <div class="stat-card balance">
        <div class="stat-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="stat-info">
          <h3>Balance Neto</h3>
          <p class="stat-value" [class]="obtenerColorBalance(resumen.ingresosGeneral - resumen.gastosGeneral)">
            {{ formatearMoneda(resumen.ingresosGeneral - resumen.gastosGeneral) }}
          </p>
          <small>Ingresos - Gastos</small>
        </div>
      </div>
    </div>

    <!-- Cuentas Grid -->
    <div class="cuentas-section">
      <h2>Mis Cuentas</h2>

      <div class="cuentas-grid" *ngIf="resumen.cuentas.length > 0">
        <div class="cuenta-card" *ngFor="let cuenta of resumen.cuentas" (click)="irACuenta(cuenta.accountId)">
          <div class="cuenta-header">
            <div class="banco-info">
              <img *ngIf="cuenta.bank_image" [src]="cuenta.bank_image" alt="Bank Logo" class="banco-logo-img"
                style="width: 32px; height: 32px; object-fit: contain; margin-right: 10px;">
              <i *ngIf="!cuenta.bank_image" class="fas {{ obtenerIconoBanco(cuenta.accountName) }} banco-icon"></i>
              <h3>{{ cuenta.accountName }}</h3>
            </div>
            <div class="cuenta-menu">
              <button class="btn-icon" (click)="irATransacciones(cuenta.accountId); $event.stopPropagation()">
                <i class="fas fa-list"></i>
              </button>
            </div>
          </div>

          <div class="cuenta-balance">
            <span class="balance-label">Saldo Disponible</span>
            <span class="balance-amount" [class]="obtenerColorBalance(cuenta.balance)">
              {{ cuenta.balance | number:'1.2-2' }}
            </span>
          </div>

          <div class="cuenta-stats">
            <div class="stat-item">
              <i class="fas fa-arrow-up text-success"></i>
              <span class="stat-label">Ingresos</span>
              <span class="stat-value">{{ cuenta.totalIngresos | number:'1.2-2' }}</span>
            </div>
            <div class="stat-item">
              <i class="fas fa-arrow-down text-danger"></i>
              <span class="stat-label">Gastos</span>
              <span class="stat-value">{{ cuenta.totalGastos | number:'1.2-2' }}</span>
            </div>
          </div>

          <div class="cuenta-footer">
            <div class="transacciones-count">
              <i class="fas fa-exchange-alt"></i>
              {{ cuenta.transaccionesCount }} transacciones
            </div>
            <div class="ultima-actividad" *ngIf="cuenta.ultimaTransaccion">
              <i class="fas fa-clock"></i>
              {{ cuenta.ultimaTransaccion | date:'dd/MM/yyyy' }}
            </div>
          </div>

          <!-- Barra de progreso del balance -->
          <div class="balance-progress">
            <div class="progress-bar" [style.width.%]="obtenerPorcentajeBalance(cuenta)"></div>
          </div>
        </div>
      </div>

      <div class="no-cuentas" *ngIf="resumen.cuentas.length === 0">
        <i class="fas fa-inbox"></i>
        <p>No tienes cuentas registradas</p>
        <button class="btn-primary" routerLink="/finanzas/cuentas">
          <i class="fas fa-plus"></i> Crear Primera Cuenta
        </button>
      </div>
    </div>

    <!-- Acciones Rápidas -->
    <div class="acciones-rapidas">
      <h2>Acciones Rápidas</h2>
      <div class="acciones-grid">
        <button class="accion-card" routerLink="/finanzas/resumen">
          <i class="fas fa-chart-pie"></i>
          <span>Ver Resumen Detallado</span>
        </button>
        <button class="accion-card" routerLink="/finanzas/balances/categorias">
          <i class="fas fa-tags"></i>
          <span>Gestionar Categorías</span>
        </button>
        <button class="accion-card" routerLink="/finanzas/balances/presupuestos">
          <i class="fas fa-calculator"></i>
          <span>Presupuestos</span>
        </button>
        <button class="accion-card" routerLink="/finanzas/balances/reportes">
          <i class="fas fa-file-alt"></i>
          <span>Reportes</span>
        </button>
      </div>
    </div>
  </div>
</div>