<!-- Contenedor principal que ocupa toda la pantalla y crea el layout de 2 columnas -->
<div class="flex h-screen bg-gray-50">

  <!-- 1. Panel Izquierdo: Barra lateral de notas -->
  <aside class="w-1/3 max-w-sm flex flex-col bg-white border-r border-gray-200">
    <!-- Cabecera de la barra lateral -->
    <div class="p-4 border-b">
      <h2 class="text-xl font-bold text-gray-800">Notas</h2>
      <input type="text" placeholder="Buscar notas..." [(ngModel)]="searchTerm" (ngModelChange)="filterNotes()"
             class="mt-2 w-full p-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500">
    </div>

    <!-- Lista de notas con scroll -->
    <div class="flex-grow overflow-y-auto">
      @for(note of filteredNotes; track note.id) {
        <button (click)="selectNote(note)"
                class="w-full text-left p-4 border-b hover:bg-gray-100"
                [ngClass]="{'bg-blue-100 hover:bg-blue-100': selectedNote?.id === note.id}">
          <h3 class="font-bold text-gray-900 truncate">{{ note.title }}</h3>
          <p class="text-sm text-gray-500">Actualizado: {{ note.updatedAt | date:'short' }}</p>
        </button>
      }
    </div>

    <!-- Pie de la barra lateral -->
    <div class="p-4 border-t">
      <button (click)="createNewNote()" class="w-full flex items-center justify-center gap-2 px-4 py-2 bg-sidebar-dark text-white rounded-lg shadow hover:bg-opacity-90 transition-colors">
        <i class="fas fa-plus"></i>
        <span>Nueva Nota</span>
      </button>
    </div>
  </aside>

  <!-- 2. Panel Derecho: Editor y Visualizador -->
  <main class="flex-grow flex flex-col">
    @if (selectedNote) {
      <!-- Cabecera del editor -->
      <div class="flex items-center justify-between p-4 border-b bg-white">
        <h2 class="text-xl font-bold text-gray-800 truncate">{{ isEditing ? 'Editando...' : selectedNote.title }}</h2>
        <div class="flex items-center gap-2">
          @if (!isEditing) {
            <button (click)="enterEditMode()" class="px-4 py-2 text-sm rounded-lg text-white bg-blue-500 hover:bg-blue-600">Editar</button>
          } @else {
            <button (click)="saveNote()" class="px-4 py-2 text-sm rounded-lg text-white bg-green-500 hover:bg-green-600">Guardar</button>
            <button (click)="cancelEdit()" class="px-4 py-2 text-sm rounded-lg text-gray-700 bg-gray-200 hover:bg-gray-300">Cancelar</button>
          }
          <button (click)="deleteNote()" class="px-4 py-2 text-sm rounded-lg text-white bg-red-500 hover:bg-red-600">Eliminar</button>
        </div>
      </div>
      
      <!-- Área de Contenido -->
      <div class="flex-grow p-8 overflow-y-auto">
        @if (!isEditing) {
          <!-- Modo Visualización con Markdown -->
          <div class="prose max-w-none">
            <markdown [data]="selectedNote.content"></markdown>
          </div>
        } @else {
          <!-- Modo Edición -->
          <div class="h-full flex flex-col gap-4">
            <input type="text" [(ngModel)]="editedTitle" placeholder="Título de la nota" class="text-2xl font-bold p-2 border rounded-lg">
            <textarea [(ngModel)]="editedContent" placeholder="Escribe tu nota aquí (soporta Markdown)..." 
                      class="flex-grow w-full p-2 border rounded-lg font-mono text-sm resize-none"></textarea>
          </div>
        }
      </div>
    } @else {
      <!-- Estado vacío cuando no hay nota seleccionada -->
      <div class="flex flex-col items-center justify-center h-full text-center text-gray-500">
        <i class="fas fa-file-alt text-6xl mb-4"></i>
        <h2 class="text-2xl font-bold">Selecciona una nota</h2>
        <p>O crea una nueva para empezar.</p>
      </div>
    }
  </main>
</div>