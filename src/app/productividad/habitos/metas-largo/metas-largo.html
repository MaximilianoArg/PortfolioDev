<!-- Contenedor principal -->
<div class="p-4 sm:p-6 lg:p-8 bg-gray-50 min-h-screen">
  
  <!-- Cabecera -->
  <div class="flex flex-wrap items-center justify-between gap-4 mb-8">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Metas a Largo Plazo</h1>
      <p class="text-gray-500 mt-1">Tu visión a futuro. Define tus grandes objetivos y los pasos para alcanzarlos.</p>
    </div>
    <button (click)="openModal()" class="flex items-center gap-2 px-4 py-2 bg-sidebar-dark text-white rounded-lg shadow hover:bg-opacity-90 transition-colors">
      <i class="fas fa-plus"></i>
      <span>Nueva Meta</span>
    </button>
  </div>
  
  <!-- Contenedor de Metas -->
  <div class="space-y-8">
    @for(goal of longTermGoals; track goal.id) {
      <!-- Tarjeta de Meta Individual -->
      <div class="bg-white rounded-xl shadow-md p-6">
        <!-- Cabecera de la Meta -->
        <div class="border-b pb-4 mb-4">
          <div class="flex items-center justify-between">
            <span class="text-xs font-semibold inline-block py-1 px-2 uppercase rounded-full" [ngClass]="getCategoryColor(goal.category)">
              {{ goal.category }}
            </span>
            <span class="text-sm text-gray-500">Objetivo: {{ goal.targetDate | date:'yyyy' }}</span>
          </div>
          <h2 class="text-2xl font-bold text-gray-800 mt-2">{{ goal.title }}</h2>
          <p class="text-gray-600">{{ goal.description }}</p>
          <!-- Barra de Progreso General de la Meta -->
          @let goalProgress = calculateGoalProgress(goal);
          <div class="mt-4">
            <div class="flex justify-between mb-1">
              <span class="text-base font-medium text-blue-700">Progreso General</span>
              <span class="text-sm font-medium text-blue-700">{{ goalProgress | number:'1.0-0' }}%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
              <div class="bg-blue-600 h-2.5 rounded-full" [style.width.%]="goalProgress"></div>
            </div>
          </div>
        </div>

        <!-- Roadmap / Línea de Tiempo de Hitos (Milestones) -->
        <div class="space-y-6">
          <h3 class="font-bold text-lg">Hitos Clave</h3>
          @for(milestone of goal.milestones; track milestone.id) {
            <div class="pl-4 border-l-2">
              <!-- Título del Hito y Progreso -->
              <div class="mb-2">
                <h4 class="font-semibold text-gray-800">{{ milestone.title }}</h4>
                @let milestoneProgress = calculateMilestoneProgress(milestone);
                <div class="w-full bg-gray-200 rounded-full h-1.5 mt-1">
                  <div class="bg-green-500 h-1.5 rounded-full" [style.width.%]="milestoneProgress"></div>
                </div>
              </div>
              <!-- Resultados Clave (Key Results) del Hito -->
              <div class="space-y-2 pl-4">
                @for(kr of milestone.keyResults; track kr.id) {
                  <label class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" [checked]="kr.completed" (change)="toggleKeyResult(kr)"
                           class="w-5 h-5 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                    <span class="text-gray-700" [ngClass]="{'line-through text-gray-400': kr.completed}">{{ kr.description }}</span>
                  </label>
                }
              </div>
            </div>
          } @empty {
            <p class="text-gray-500 pl-4">Aún no has definido hitos para esta meta.</p>
          }
        </div>
      </div>
    }
  </div>
</div>

<!-- Modal para Añadir/Editar Meta -->
@if (isModalOpen) {
  <div class="fixed inset-0 bg-black/60 flex items-center justify-center z-50" (click)="closeModal()">
    <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-lg mx-4" (click)="$event.stopPropagation()">
      <h2 class="text-2xl font-bold mb-6">Nueva Meta a Largo Plazo</h2>
      <p class="text-gray-600 mb-6">El formulario para añadir/editar metas, hitos y resultados clave iría aquí.</p>
      <div class="flex justify-end gap-4">
        <button (click)="closeModal()" class="px-4 py-2 rounded-lg text-gray-600 bg-gray-100 hover:bg-gray-200">Cancelar</button>
        <button class="px-4 py-2 rounded-lg text-white bg-blue-500 hover:bg-blue-600">Guardar</button>
      </div>
    </div>
  </div>
}